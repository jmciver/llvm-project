// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --version 2
// RUN: %clang_cc1 -triple x86_64-unknown-unknown -O3 -emit-llvm -o - %s | FileCheck %s

// CHECK-LABEL: define internal fastcc i32 @foo
// CHECK-SAME: (i32 [[I:%.*]]) #[[ATTR0:[0-9]+]] {
// CHECK-NEXT:  entry:
// CHECK-NEXT:    br label [[L3:%.*]]
// CHECK:       L3:
// CHECK-NEXT:    ret i32 210
//
static int foo(unsigned i) {
  void *addrs[] = {&&L1, &&L2, &&L3, &&L4, &&L5};
  int res = 1;

  goto *addrs[i];
L5:
  res *= 11;
L4:
  res *= 7;
L3:
  res *= 5;
L2:
  res *= 3;
L1:
  res *= 2;
  return res;
}

static int foo2(unsigned i) {
  static const void *addrs[] = {&&L1, &&L2, &&L3, &&L4, &&L5};
  int res = 1;

  goto *addrs[i];
L5:
  res *= 11;
L4:
  res *= 7;
L3:
  res *= 5;
L2:
  res *= 3;
L1:
  res *= 2;
  return res;
}

// CHECK-LABEL: define dso_local i32 @main
// CHECK-SAME: () local_unnamed_addr #[[ATTR0]] {
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[CALL:%.*]] = tail call fastcc i32 @foo(i32 poison)
// CHECK-NEXT:    [[ADD:%.*]] = add nsw i32 [[CALL]], 2310
// CHECK-NEXT:    ret i32 [[ADD]]
//
int main(void) { return foo(3) + foo2(4); }
